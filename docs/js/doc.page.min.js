/*!
 * ZUI - v1.3.0 - 2015-05-18
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2015 cnezsoft.com; Licensed MIT
 */

!function(a,b){"use strict";String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();(void 0===b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}),String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)});var c=function(b,c){var d=new RegExp("(^|&)"+b+"=([^&]*)(&|$)","i"),e=a.location.search.substr(1).match(d);return null!==e?unescape(e[2]):c},d=c("debug",0);d&&console.error("DEBUG ENABLED.");var e,f,g={learn:{col:1},start:{col:1},basic:{col:1},control:{col:2},component:{col:2},javascript:{col:3},view:{col:3},promotion:{col:1,row:2},resource:{col:1,row:2},contribution:{col:1,row:2}},h="../index.json",i="../../package.json",j={};d&&(a.dataset=j);var k,l,m,n,o,p,q,r,s,t,u,v,w={standard:null,lite:null,separate:null},x="ZUI",y=function(a){return"string"==typeof a?(a=a.toLowerCase(),a.startsWith("http://")||a.startsWith("https://")):!1},z=function(){k.css("padding-right",""),u.css("padding-right","")},A=function(a,c){var g=j[a],i=g&&g.version,l=a===h;if(!i&&f){var m=b.zui.store.get("//"+a,null);if(null!==m){var n=b.zui.store.get("//"+a+"::V");n&&(g={data:m,version:n},j[a]=g,i=!0,d&&console.log("Load",a,"from storage:",g))}}if(!i||!l&&g.version!==e||(d&&console.log("Load",a,"from cache:",g),c(g.data),l||d)){var o=a.endsWith(".json")?"json":"html";b.get(a,function(f){null!==f?(l&&(e=f.version),g={data:f,version:e},j[a]=g,b.zui.store.set("//"+a,f),b.zui.store.set("//"+a+"::V",e),d&&console.log("Load",a,"from remote:",g),c(f)):i&&!l&&(d&&console.log("Failed load",a,"from remote, instead load cache:",g),c(g.data))},o).error(function(){d&&console.error("Ajax error:",a),i&&!l&&(d&&console.log("Failed load",a,"from remote with error, instead load cache:",g),c(g.data)),k.hasClass("page-open")&&t.children(".loader").addClass("with-error")})}},B=function(a,c){var d=j[h].data;return d?(b.each(g,function(e,f){if(d.chapters[e]){b.extend(f,d.chapters[e]);var g=f.sections,h=null;return c&&(h=c(f,g),h===!1)?!1:void b.each(g,function(b,c){return a(f,c,h)===!1?!1:void 0})}}),!0):(console.error("Document index is empty."),!1)},C=function(a,b){var c=b.icon;a.attr("class","icon").text("").css("background-image",""),(void 0===c||null===c||""===c)&&(c=b.name.substr(0,1).toUpperCase()),c.startsWith("icon-")?a.addClass(c):c.endsWith(".png")?a.css("background-image","url("+c+")").addClass("with-img"):a.addClass("text-icon").text(c)},D=function(){B(function(a,b,c){var d=a.id;b.chapter=d,b.chapterName=a.name,b.accent=a.accent;var e=b.url;"undefined"==typeof e?(b.url="../part/"+b.chapter+"-"+b.id+".html",b.target="page"):y(e)?b.target="external":e&&e.endsWith(".md")?(b.target="page",b.targetType="markdown",".md"===e&&(b.url="../part/"+b.chapter+"-"+b.id+".md")):b.target="";var f=(d+"-"+b.id,"#"+d+"/"+b.id);if(b.topics&&b.topics.length){var g=0;for(var h in b.topics){var i=b.topics[h];"undefined"==typeof i.id&&(i.id=h);{"undefined"==typeof i.url?f+"/"+g++:i.url}}}})?k.children(".loader").removeClass("loading"):d&&console.error("Display sections failed.")},E=function(){if(a.afterPageLoad=null,a.onPageLoad=null,b.isFunction(a.onPageClose)&&(a.onPageClose(),a.onPageClose=null),k.hasClass("page-open")){var c=p.data("trans-style");return c&&(c["max-height"]="",p.css(c)),k.addClass("page-show-out").removeClass("page-open page-show-in"),""!==m.val()&&m.focus(),a.document.title=x,setTimeout(function(){k.removeClass("page-show page-show-out"),z()},300),!0}return!1},F=function(a){p.removeClass("page-collapsed");var b=typeof a;if("undefined"!==b){if("string"===b){var c=parseInt(a);c!==0/0&&(b="number",a=c)}var d=function(a){a&&a.length&&(K(!1),K(a.addClass("hover"),!0))};"number"===b?d(r.children("section").eq(a)):"string"===b&&b.length}},G=function(){p.removeClass("loading"),s.removeClass("loading"),k.addClass("page-show page-show-in")},H=function(){var c=!1;b.isFunction(a.onPageLoad)&&(c=a.onPageLoad()===!1),r.find('img[src^="docs/"]').each(function(){var a=b(this);a.attr("src",a.attr("src").replace(/docs\//g,"../"))}),setTimeout(function(){b.isFunction(a.afterPageLoad)&&a.afterPageLoad(G)===!0&&H();var c=t.find("pre");c.length&&a.prettyPrint&&(c.addClass("prettyprint"),a.prettyPrint())},1e3),c||G()},I=function(c,e){var f=c.chapter+"-"+c.id;if(k.hasClass("page-open")&&f===k.attr("data-page"))return void(d&&console.error("The page already showed."));var g="#"+c.chapter+"/"+c.id;e&&(g+="/"+e),a.document.title=c.chapterName+" > "+c.name+" - "+x,a.ga&&b.isFunction(ga)&&ga("send","pageview",a.location.pathname+g),k.attr("data-page-accent",c.accent).attr("data-page",f),C(q.find(".icon"),c),q.find(".name").text(c.name).attr("href",g),q.find(".desc").text(c.desc),n.hide(),n.children(".badge-author").toggle(!!c.author).find(".author-name").text(c.author),n.children(".badge-source").toggle(!!c.url).attr("href","https://github.com/easysoft/zui/tree/master/"+c.url);var h=c.lib;h&&(n.children(".badge-zui").toggle(!!h.bundles.standard),n.children(".badge-lite").toggle(!!h.bundles.lite),n.children(".badge-lib").toggle(!!h.bundles.separate),n.children(".badge-custom").toggle(!!h.custom),n.children(".badge-version").toggle(!!h.ver).text(h.ver+"+"),n.children(".badge-party").toggle(!!h.thirdpart).attr("href",h.partUrl||"javascript:;").find(".product-ver").text(h.pver)),r.html(""),p.addClass("loading"),s.removeClass("with-error").addClass("loading");var i;A(c.url,function(a){var d=function(){if(marked&&"markdown"===c.targetType){var d,f=b(),g=b(marked(a)),h=!0,i=g.filter("h2").length>0;g.each(function(){var a=b(this),c=a.prop("tagName");return"STYLE"===c||"SCRIPT"===c?void(f=f.add(a)):h?("H1"===c&&q.find("h2 > .name").text(a.html()),void(h=!1)):void(i&&("H1"===c||"H2"===c)||!i&&"H3"===c?(d&&(f=f.add(d)),d=b("<section><header><h3>"+a.html()+"</h3></header><article></article></section>")):(i&&("H3"===c?a=b("<h4>").html(a.html()):"H4"===c?a=b("<h5>").html(a.html()):"H5"===c&&(a=b("<h6>").html(a.html()))),d||(d=b("<article></article>")),"ARTICLE"===d.prop("tagName")?d.append(a):d.children("article").append(a)))}),d&&(f=f.add(d)),r.empty().append(f)}else r.html(a);t.scrollTop(0),F(e),H(),n.show()};i&&clearTimeout(i),p.hasClass("openning")?i=setTimeout(d,320):d()})},J=function(c,e){if(d&&console.log("openSection",c,e),c=c||o,b.isArray(c)){if("undefined"!=typeof e&&(c=c.push(e)),!c[0])return void(d&&console.error("Open section failed: can't find the section with id "+c.join("-")));if(c.length>0&&"search"===c[0])return void query(c[1]);var f=j[h].data;if(!(f&&c.length>1))return void(d&&console.error("Open section stop by null docIndex or wrong section value."));var g=c[1],i=f.chapters[c[0]].sections,k=!1;for(var l in i){var m=i[l];if(m.id===g){c.length>2&&(e=c[2]),c=m,k=!0;break}}if(!k)return void(d&&console.error("Open section failed: can't find the section with id "+c.join("-")))}if(""===c.url)return void b.zui.messager.show("该链接所指示的文档尚未完成。你可以Fork项目来完善文档。");switch(c.target){case"external":a.open(c.url,"_blank");break;case"page":I(c,e);break;default:d&&console.error("Open section failed: unknown target.")}},K=function(a,b){var c=typeof a;if("object"===c){"undefined"==typeof b&&(b=a.hasClass("collapsed")),a.toggleClass("collapsed",!b);var d=r.children("section"),e=d.length,f=d.filter(".collapsed").length;0===f?p.removeClass("page-collapsed"):f===e&&p.addClass("page-collapsed")}else b="boolean"===c?a:p.hasClass("page-collapsed"),p.toggleClass("page-collapsed",!b),b?r.children("section").removeClass("collapsed"):r.children("section").addClass("collapsed")},L=function(b){d&&console.log("Open page url",b),b.startsWith("#")?(b=b.substr(1),setTimeout(function(){var a=b.split("/"),c=a[0].toLowerCase();"search"===c||"query"===c?query(a[1]):J(a)},600)):y(b)?a.open(b,"_blank"):d&&console.error("Open page url failed: unknown url",b)},M=function(a,b,c){if(b){var d=b.length;a=a.toLowerCase();for(var e=a+"s",f=0;d>f;++f){var g=b[f];if(g===a||g===e||c&&!c.src&&M(a,c.dpds))return!0}}return!1},N=function(a,c,d,e){return e||(e=[]),b.isArray(e)||(e=[e]),c.bundles&&b.each(c.bundles,function(b,c){a.builds[c]?N(a,a.builds[c],d,e):e=O(d,[c],e)}),c.basicDpds&&(e=O(d,c.basicDpds,e)),e=O(d,c.includes,e,c.ignoreDpds)},O=function(a,c,d,e,f){if(d=d||[],b.isArray(c))b.each(c,function(b,c){O(a,c,d,e)});else{var g=a[c];g&&d.indexOf(c)<0&&(!e&&g.dpds&&O(a,g.dpds,d,e),(g.src||!f)&&d.push(c))}return d},P=function(){A(i,function(a){b(".zui-version").text("v"+a.version),w.standard=N(a,a.builds.standard,a.lib),w.lite=N(a,a.builds.lite,a.lib),w.separate=N(a,a.builds.separate,a.lib),B(function(c,d,e){var f=a.lib[d.id]||a.lib[d.id+"s"],g={bundles:{}};if(b.each(w,function(a,b){M(d.id,b,f)&&(g.bundles[a]=!0)}),f)if(f.thirdpart&&(g.thirdpart=!0,g.partUrl=f.website,g.pver=f.pver),!f.src&&f.dpds&&(g.custom=!0),f.ver)g.ver=f.ver;else if(g.custom)for(var h=0;h<f.dpds.length;++h){var i=f.dpds[h],j=a.lib[i]||a.lib[i+"s"];if(j&&j.ver){g.ver=j.ver;break}}d.lib=g})})},Q=function(a){a.length&&A(i,function(c){var d,e,f=b("<tbody></tbody>"),g=function(a){return c.lib[a].name};for(var h in c.lib){var i=c.lib[h];if(!i.custom){var j="";if(!i.src&&i.dpds){var k=O(c.lib,i.dpds,null,!0,!0);j="合并组件包含：",j+=b.map(k,g).join("、")}d=b("<tr/>"),e=b("<td/>"),e.attr("title",i.desc),e.html("<strong>"+i.name+"</strong> ("+h+(i.pver?" v"+i.pver:"")+")"),d.append(e),b.each(w,function(a,c){e=b('<td class="text-center"/>'),c.indexOf(h)>-1?e.addClass("success").html('<i class="text-success icon-ok"></i>'):e.html('<i class="text-muted icon-remove"></i>'),d.append(e)}),e=b("<td/>"),e.html(i.ver?" v"+i.ver+"+":j),d.append(e),f.append(d)}}a.find("tbody").remove(),a.append(f),a.datatable({rowHover:!1,fixedHeaderOffset:60})})},R=function(){x=a.document.title;l=b(a),k=b("body"),u=b("#navbar"),v=b("#header"),p=b("#page"),q=b("#pageHeader"),n=b("#pageAttrs"),s=b("#pageLoader"),t=b("#pageBody"),r=b("#pageContent"),b.each(g,function(a,b){a=a.toLowerCase(),b.id=a}),f=b.zui.store&&b.zui.store.enable,b.ajaxSetup({cache:!1});var c=!0;A(h,function(b){if(D(b),!c){var d=a.location.hash;d&&L(d),P()}c=!1});b(document).on("click",'a[href^="#"]',function(){L(b(this).attr("href"))}),r.on("click","section > header > h3",function(){K(b(this).closest("section"))}).on("mouseenter","section > header > h3",function(){b(this).closest("section").addClass("hover")}).on("mouseleave","section > header > h3",function(){b(this).closest("section").removeClass("hover")}),p.on("click","#pageTogger",function(){K()}),t.on("scroll",function(a){p.toggleClass("with-shadow",t.scrollTop()>20)}),b('[data-toggle="tooltip"]').tooltip({container:"body"})};R(),b.doc={openSection:J,closePage:E,loadData:A,mutePageLoading:G,displayPkgLibTable:Q}}(window,jQuery);