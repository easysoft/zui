<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ZUIï¼Œä¸€ä¸ªç®€å•çµæ´»çš„å‰ç«¯æ¡†æ¶ã€‚">
    <meta name="author" content="Zentao">
    <title>ZUI - KindEditor è‡ªå®šä¹‰ Holder æ’ä»¶</title>
    <link href="../../dist/css/zui.css" rel="stylesheet">
</head>

<body style="padding: 20px">
    <div class="container" id="contextmenuExample">
        <div class="article-content">
            <h1>KindEditor è‡ªå®šä¹‰å·¥å…·ä¾‹å­</h1>
            <p>Holder æ’ä»¶èƒ½å¤Ÿåœ¨ç¼–è¾‘å™¨å†…æ’å…¥è‡ªå®šä¹‰å†…å®¹ï¼Œè¿™äº›è‡ªå®šä¹‰å†…å®¹åŒ…å«éšè—çš„æ–‡æœ¬å’Œåœ¨ç•Œé¢ä¸Šå®é™…æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œå¹¶ä¸”å®é™…æ˜¾ç¤ºçš„æ–‡æœ¬æ— æ³•ç›´æ¥ç¼–è¾‘ï¼Œåªèƒ½åœ¨å¤–éƒ¨è¿›è¡Œæ›´æ–°ã€‚</p>
            <p>ç‚¹å‡»ç¼–è¾‘å™¨ä¸Šçš„å·¥å…·æ  <span class="ke-icon-holder" style="width: 16px; height: 16px; display: inline-block;"></span> è¯•è¯•å§ï¼å¦‚æœè¦äº†è§£å®ç°ï¼Œè¯·æŸ¥çœ‹æœ¬é¡µé¢æºç ã€‚</p>
        </div>
        <div class="row">
            <div class="col-md-7">
                <textarea id="content" name="content" class="form-control kindeditor" style="height:500px;">Hello, world!</textarea>
                <br>
                </div>
            <div class="col-md-5">
                <textarea id="content2" readonly name="content2" class="form-control" style="height:500px;">Hello, world!</textarea>
            </div>
        </div>
    </div>

    <div class="modal fade" id="holderModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span
                            class="sr-only">å…³é—­</span></button>
                    <h4 class="modal-title" id='holderModalTitle'>æ·»åŠ  Holder</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="holderText">è¯·è¾“å…¥åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºçš„æ–‡æœ¬</label>
                        <input id="holderText" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="holderValue">è¯·è¾“å…¥è¦éšè—çš„å†…å®¹</label>
                        <textarea class="form-control" name="holderValue" id="holderValue" cols="30" rows="10"></textarea>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="holderAsBlock"> ä½œä¸ºåŒºå—ï¼ˆå•ç‹¬å ä¸€è¡Œï¼‰
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-primary" id='holderSaveBtn'>ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../../assets/jquery.js"></script>
    <script src="../../dist/js/zui.js"></script>
    <script src="../../dist/lib/kindeditor/kindeditor.js"></script>

    <style>
    /* æ·»åŠ  holder æ’ä»¶ç›¸å…³æ ·å¼ */
    .ke-icon-holder {background: none; border: 1px solid red; text-align: center; border-radius: 50%; background-color: red; line-height: 14px;}
    .ke-icon-holder:before {content: 'H'; font-size: 14px; font-weight: bold; color: #fff;}
    </style>
    <script>
        // æ·»åŠ  Holder æ’ä»¶
        KindEditor.plugin('holder', function(K) {
            var self = this;

            if (!self.options.htmlTags) {
                self.options.htmlTags = {};
            }
            if (!self.options.htmlTags.div) {
                self.options.htmlTags.div = [];
            }
            if (!self.options.htmlTags.span) {
                self.options.htmlTags.span = [];
            }
            self.options.htmlTags.div.push('data-holder', 'data-holder-edit', 'contenteditable');
            self.options.htmlTags.span.push('data-holder', 'data-holder-edit', 'contenteditable');

            self.afterCreate(function() {
                $(self.edit.doc.head).append([
                    '<style>',
                    '.holder-element {border: 1px solid #ea644a; background: #ffe5e0; border-radius: 4px; padding: 0 5px; cursor: pointer; color: #ea644a; position: relative; min-width: 50px; text-align: center}',
                    '.holder-value {width: 20px; font-size: 0; position: absolute; top: 0; right: 0; bottom: 0;}',
                    '.holder-element:before {content: attr(data-holder)}',
                    '.holder-block {display: block; text-align: center}',
                    '.holder-span {display: inline-block; line-height: 1}',
                    '.holder-value:after {content: "ğ„‚"; display: block; position: absolute; right: 0; top: 0; bottom: 0; border-radius: 0 3px 3px 0; background: #ffe5e0; text-align: center; font-size: 14px; display: flex; justify-content: center; align-items: center; width: 20px; border-left: 1px solid #ea644a; opacity: 0}',
                    '.holder-element:hover .holder-value:after {opacity: 1}',
                    '.holder-value:hover:after {background: #ea644a; color: #fff}',
                    '</style>'
                ].join('\n'));

                $(self.edit.doc).find('.holder-element[contenteditable="true"]').attr('contenteditable', false);

                if (self.options.holderEdit) {
                    $(self.edit.doc).on('click', '.holder-element', function(e) {
                        var $ele = $(this);
                        if($(e.target).is('.holder-value')) {
                            $ele.remove();
                            self.cmd.select();
                            self.sync();
                            return;
                        }
                        showHolderEditModal($ele.attr('data-holder'), $ele.find('.holder-value').text(), $ele.hasClass('holder-block'), function(text, value, asBlock) {
                            var $holderElement = $(asBlock ? '<div>' : '<span>').attr('data-holder', text).attr('contenteditable', false).addClass(asBlock ? 'holder-block' : 'holder-span').addClass('holder-element');
                            $holderElement.append($(asBlock ? '<div>' : '<span>').addClass('holder-value').text(value));
                            if (self.options.holderEditText) {
                                $holderElement.attr('data-holder-edit', self.options.holderEditText);
                            }
                            $ele.replaceWith($holderElement);
                            self.edit.focus();
                            self.sync();
                        });
                    });
                }
            });

            // ç‚¹å‡»å›¾æ ‡æ—¶æ‰§è¡Œ
            self.clickToolbar('holder', function() {
                showHolderEditModal('', '', false, function(text, value, asBlock) {
                    var $holderElement = $(asBlock ? '<div>' : '<span>').attr('data-holder', text).attr('contenteditable', false).addClass(asBlock ? 'holder-block' : 'holder-span').addClass('holder-element');
                    $holderElement.append($(asBlock ? '<div>' : '<span>').addClass('holder-value').text(value));
                    if (self.options.holderEditText) {
                        $holderElement.attr('data-holder-edit', self.options.holderEditText);
                    }
                    self.insertHtml($holderElement[0].outerHTML + '&nbsp;' + (asBlock ? '<br>' : ''));
                });
            });
        });

        function showHolderEditModal(placeholder, value, asBlock, callback) {
            if (typeof placeholder === 'function') {
                callback = placeholder;
                placeholder = '';
                value = '';
                asBlock = false;
            }
            placeholder = placeholder || '';
            value = value || '';
            $('#holderText').val(placeholder);
            $('#holderValue').val(value);
            $('#holderAsBlock').prop('checked', !!asBlock);
            $('#holderModal').modal('show');
            $('#holderSaveBtn').off('click').on('click', function() {
                if (callback) {
                    callback($('#holderText').val(), $('#holderValue').val(), $('#holderAsBlock').is(':checked'))
                }
                $('#holderModal').modal('hide');
            });
        };

        // åˆå§‹åŒ– KindEditor
        $(function () {
            $('#content').val([
                '<h1 style="text-align:center;">é¡¹ç›®è¿›åº¦æŠ¥å‘Š</h1>',
                '<p>æœ¬æ–‡å°†ä»‹ç»é¡¹ç›®<span data-holder="$projectName" contenteditable="true" class="holder-span holder-element" data-holder-edit="å³é”®è¿›è¡Œæ“ä½œ"><span class="holder-value">{{$projectName}}</span></span>&nbsp;çš„ä»»åŠ¡åœ¨æœ¬å‘¨&nbsp;<span data-holder="$weekTime" contenteditable="false" class="holder-span holder-element" data-holder-edit="å³é”®è¿›è¡Œæ“ä½œ"><span class="holder-value">{{$weekTime}}</span></span>&nbsp; è¿›å±•æƒ…å†µã€‚</p>',
                '<h2>å·²å®Œæˆçš„ä»»åŠ¡</h2>',
                '<div data-holder="$finishTaskList" contenteditable="false" class="holder-block holder-element" data-holder-edit="å³é”®è¿›è¡Œæ“ä½œ">',
                '<div class="holder-value">{{æ­¤å¤„æ‰“å°å·²å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨}}</div>',
                '</div>',
                '&nbsp;',
                '<h2>æœªå®Œæˆçš„ä»»åŠ¡</h2>',
                '<p><br /></p>',
                '<div data-holder="$waitTaskList" contenteditable="false" class="holder-block holder-element" data-holder-edit="å³é”®è¿›è¡Œæ“ä½œ">',
                '<div class="holder-value">{{$waitTaskList}}</div>',
                '</div>',
                '&nbsp;',
                '<p><br /></p>',
                '&nbsp;',
                '<p>',
                '<table class="table table-kindeditor ke-select-col" style="width:100%;">',
                '    <tbody>',
                '    <tr>',
                '        <td style="border:1px solid #ddd;" class="">æŠ¥å‘Šäºº<br /></td>',
                '        <td style="border:1px solid #ddd;"><span data-holder="$userName" contenteditable="false" class="holder-span holder-element" data-holder-edit="å³é”®è¿›è¡Œæ“ä½œ"><span class="holder-value">{{$userName}}</span></span>&nbsp;<br /></td>',
                '    </tr>',
                '    <tr>',
                '        <td style="border:1px solid #ddd;" class="">æŠ¥å‘Šæ—¶é—´</td>',
                '        <td style="border:1px solid #ddd;"><span data-holder="$time" contenteditable="false" class="holder-span holder-element" data-holder-edit="å³é”®è¿›è¡Œæ“ä½œ"><span class="holder-value">{{$time}}</span></span>&nbsp;<br /></td>',
                '    </tr>',
                '    </tbody>',
                '</table>',
                '<br />',
                '</p>',
            ].join('\n'));


            const toolbarItems = [
                    // æ·»åŠ  Holder æ’ä»¶å›¾æ ‡
                    'holder', '|',
                    'source', '|', 'undo', 'redo', '|', 'preview', 'code', 'cut', 'copy', 'paste', '|', 'justifyleft', 'justifycenter', 'justifyright',
                    'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'quickformat', 'selectall', '|', 'fullscreen', '/',
                    'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
                    'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'table', 'hr', 'emoticons', 'pagebreak',
                    'link', 'unlink', '|'
            ];

            window.$editor = KindEditor.create('textarea.kindeditor', {
                wellFormatMode: true,
                simpleWrap: true,
                indentChar: '  ',
                width: '100%',
                basePath: '../../dist/lib/kindeditor/',
                allowFileManager: true,
                bodyClass: 'article-content',
                cssPath: '../../dist/css/zui.css',
                placeholder: 'è¯·è¾“å…¥æ–‡ç« å†…å®¹\nGood Luck!',
                transferTab: true,
                afterChange: function(e) {
                    $('#content2').val(this.edit.html());
                },
                items: toolbarItems,

                // è®¾ç½® holder é¼ æ ‡æ‚¬åœæ—¶çš„æç¤ºç¼–è¾‘æ–‡æœ¬
                holderEditText: 'ç¼–è¾‘',

                // å¯ç”¨ç¼–è¾‘ holder åŠŸèƒ½
                holderEdit: true,
            });
        });
    </script>
</body>

</html>
