/*!
 * ZUI - v1.4.0 - 2016-05-11
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2016 cnezsoft.com; Licensed MIT
 */

!function(t,e){"use strict";if("undefined"==typeof t)throw new Error("ZUI requires jQuery");t.zui||(t.zui=function(e){t.isPlainObject(e)&&t.extend(t.zui,e)});var o=0;t.zui({uuid:function(){return 1e3*(new Date).getTime()+o++%1e3},callEvent:function(e,o,n){if(t.isFunction(e)){void 0!==n&&(e=t.proxy(e,n));var i=e(o);return o&&(o.result=i),!(void 0!==i&&!i)}return 1},clientLang:function(){var o,n=e.config;if("undefined"!=typeof n&&n.clientLang)o=n.clientLang;else{var i=t("html").attr("lang");o=i?i:navigator.userLanguage||navigator.userLanguage||"zh_cn"}return o.replace("-","_").toLowerCase()}}),t.fn.callEvent=function(e,o,n){var i=t(this),r=e.indexOf(".zui."),s=0>r?e:e.substring(0,r),a=t.Event(s,o);if(void 0===n&&r>0&&(n=i.data(e.substring(r+1))),n&&n.options){var l=n.options[s];t.isFunction(l)&&t.zui.callEvent(l,a,n)}return i.trigger(a),a}}(jQuery,window),function(t,e,o){"use strict";var n=function(e,o){this.$=t(e),this.options=this.getOptions(o),this.init()};n.DEFAULTS={container:"body",deviation:5,sensorOffsetX:0,sensorOffsetY:0},n.prototype.getOptions=function(e){return e=t.extend({},n.DEFAULTS,this.$.data(),e)},n.prototype.callEvent=function(e,o){return t.zui.callEvent(this.options[e],o,this)},n.prototype.init=function(){this.handleMouseEvents()},n.prototype.handleMouseEvents=function(){var n=this.$,i=this,r=this.options,s="before";this.$triggerTarget=r.trigger?(t.isFunction(r.trigger)?r.trigger(n):n.find(r.trigger)).first():n,this.$triggerTarget.on("mousedown",function(a){function l(e){var s={left:e.pageX,top:e.pageY};if(!(o.abs(s.left-E.left)<r.deviation&&o.abs(s.top-E.top)<r.deviation)){if(null===g){var a=c.css("position");"absolute"!=a&&"relative"!=a&&"fixed"!=a&&(p=a,c.css("position","relative")),g=n.clone().removeClass("drag-from").addClass("drag-shadow").css({position:"absolute",width:n.outerWidth(),transition:"none"}).appendTo(c),n.addClass("dragging"),i.callEvent("start",{event:e,element:n})}var l={left:s.left-w.left,top:s.top-w.top},f={left:l.left-y.left,top:l.top-y.top};g.css(f),C.left=s.left,C.top=s.top;var u=!1;h=!1,r.flex||d.removeClass("drop-to");var b=null;if(d.each(function(){var e=t(this),o=e.offset(),n=e.outerWidth(),i=e.outerHeight(),a=o.left+r.sensorOffsetX,l=o.top+r.sensorOffsetY;return s.left>a&&s.top>l&&s.left<a+n&&s.top<l+i&&(b&&b.removeClass("drop-to"),b=e,!r.nested)?!1:void 0}),b){h=!0;var O=b.data("id");n.data("id")!=O&&(m=!1),(null===v||v.data("id")!==O&&!m)&&(u=!0),v=b,r.flex&&d.removeClass("drop-to"),v.addClass("drop-to")}r.flex?null!==v&&v.length&&(h=!0):(n.toggleClass("drop-in",h),g.toggleClass("drop-in",h)),i.callEvent("drag",{event:e,isIn:h,target:v,element:n,isNew:u,selfTarget:m,clickOffset:w,offset:l,position:{left:l.left-y.left,top:l.top-y.top},mouseOffset:s}),e.preventDefault()}}function f(o){if(p&&c.css("position",p),null===g)return n.removeClass("drag-from"),t(e).unbind("mousemove",l).unbind("mouseup",f),void i.callEvent("always",{event:o,cancel:!0});h||(v=null);var r=!0,s={left:o.pageX,top:o.pageY},a={left:s.left-w.left,top:s.top-w.top},u={left:s.left-C.left,top:s.top-C.top};C.left=s.left,C.top=s.top;var b={event:o,isIn:h,target:v,element:n,isNew:!m&&null!==v,selfTarget:m,offset:a,mouseOffset:s,position:{left:a.left-y.left,top:a.top-y.top},lastMouseOffset:C,moveOffset:u};r=i.callEvent("beforeDrop",b),r&&h&&i.callEvent("drop",b),t(e).unbind("mousemove",l).unbind("mouseup",f),d.removeClass("drop-to"),n.removeClass("dragging").removeClass("drag-from"),g.remove(),i.callEvent("finish",b),i.callEvent("always",b),o.preventDefault()}if(r.hasOwnProperty(s)&&t.isFunction(r[s])){var u=r[s]({event:a,element:n});if(void 0!==u&&!u)return}var p,d=t.isFunction(r.target)?r.target(n):t(r.target),v=null,g=null,c=t(r.container).first(),h=!1,m=!0,b=n.offset(),E={left:a.pageX,top:a.pageY},y=c.offset(),w={left:E.left-b.left,top:E.top-b.top},C={left:E.left,top:E.top};n.addClass("drag-from"),t(e).bind("mousemove",l).bind("mouseup",f),a.preventDefault()})},n.prototype.reset=function(){this.$triggerTarget.off("mousedown"),this.handleMouseEvents()},t.fn.droppable=function(e){return this.each(function(){var o=t(this),i=o.data("zui.droppable"),r="object"==typeof e&&e;i||o.data("zui.droppable",i=new n(this,r)),"string"==typeof e&&i[e]()})},t.fn.droppable.Constructor=n}(jQuery,document,Math);