/*!
 * ZUI: 数据表格② - v1.8.0 - 2017-12-29
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2017 cnezsoft.com; Licensed MIT
 */
/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var i=t||window.event,n=s.call(arguments,1),d=0,h=0,g=0,f=0,u=0,p=0;if(t=e.event.fix(i),t.type="mousewheel","detail"in i&&(g=i.detail*-1),"wheelDelta"in i&&(g=i.wheelDelta),"wheelDeltaY"in i&&(g=i.wheelDeltaY),"wheelDeltaX"in i&&(h=i.wheelDeltaX*-1),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(h=g*-1,g=0),d=0===g?h:g,"deltaY"in i&&(g=i.deltaY*-1,d=g),"deltaX"in i&&(h=i.deltaX,0===g&&(d=h*-1)),0!==g||0!==h){if(1===i.deltaMode){var v=e.data(this,"mousewheel-line-height");d*=v,g*=v,h*=v}else if(2===i.deltaMode){var m=e.data(this,"mousewheel-page-height");d*=m,g*=m,h*=m}if(f=Math.max(Math.abs(g),Math.abs(h)),(!l||f<l)&&(l=f,r(i,f)&&(l/=40)),r(i,f)&&(d/=40,h/=40,g/=40),d=Math[d>=1?"floor":"ceil"](d/l),h=Math[h>=1?"floor":"ceil"](h/l),g=Math[g>=1?"floor":"ceil"](g/l),c.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();u=t.clientX-y.left,p=t.clientY-y.top}return t.deltaX=h,t.deltaY=g,t.deltaFactor=l,t.offsetX=u,t.offsetY=p,t.deltaMode=0,n.unshift(t,d,h,g),o&&clearTimeout(o),o=setTimeout(a,200),(e.event.dispatch||e.event.handle).apply(this,n)}}function a(){l=null}function r(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120===0}var o,l,i=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(e.event.fixHooks)for(var d=i.length;d;)e.event.fixHooks[i[--d]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var a=n.length;a;)this.addEventListener(n[--a],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var a=n.length;a;)this.removeEventListener(n[--a],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var a=e(t),r=a["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(a.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function(e,t){"use strict";var a="zui.datagrid",r={date:{getter:function(e,t,a){var r=a.options.defaultDateFormater;return e+","+Date.create(e).format(r)},setter:function(e,t,a){if("string"==typeof e){var r=Number.parseInt(e,10);Number.isNaN(r)||(e=r)}return Date.timestamp(e)}}},o={},l={page:0,recTotal:0,recPerPage:10},i={fixedLeftUntil:0,fixedTopUntil:0,order:"asc",sortBy:null,pager:l,selections:{}},n=function(t,a){var r=0,o=a.length,l=0,i={};return e.each(t,function(e,t){var n=typeof t;"number"===n||"number"===n?t+="":"string"!==n&&(t=JSON.stringify(n));for(var s=0,d=0;d<o;++d){var c=a[d];t.includes(c)&&(s=t.startsWith(c)?10:20,i[c]||(i[c]=1,l++))}r+=s}),r=l===o?r:0},s=function(e,t){return e==t?0:e<t?-1:1},d={zh_cn:{errorCannotGetDataFromRemote:"无法从远程服务器（{0}）获取数据。",errorCannotHandleRemoteData:"无法处理远程服务器返回的数据。"},zh_tw:{errorCannotGetDataFromRemote:"無法從遠程服務器（{0}）獲取數據。",errorCannotHandleRemoteData:"無法處理遠程服務器返回的數據。"},en:{errorCannotGetDataFromRemote:"Cannot fetch data from remote server {0}.",errorCannotHandleRemoteData:"Cannot handle the remote data."}},c=function(t,l){var n=this,s=n.$=e(t);n.name=a,n.uuid=e.zui.uuid(),n.id="zui-datagrid-"+n.uuid,l=e.extend({},c.DEFAULTS,n.$.data(),l);var h=l.lang||"zh_cn";n.lang=e.isPlainObject(h)?e.extend(!0,{},d[h.lang||e.zui.clientLang()],h):d[h],l.valueOperator=e.extend({},r,l.valueOperator),l.rowDefaultHeight=l.rowDefaultHeight||30,l.headerHeight=l.headerHeight||l.rowDefaultHeight||30,"number"!=typeof l.borderWidth&&(l.borderWidth=1),n.options=l;var g=s.find(".datagrid-container:first");g.length||(g=e('<div class="datagrid-container" />').appendTo(s)),g.css({width:l.width,borderWidth:l.borderWidth});var f=e(document),u=function(t){var r=g.find(".datagrid-scrollbar-"+t);r.length||(r=e('<div class="datagrid-scrollbar datagrid-scrollbar-'+t+'"><div class="bar"></div></div>').appendTo(g));var o,l,i,s,d=!1,c=null,h=".scrollbar"+t+"."+a+"."+n.uuid,u=function(e){if(d){var a=e["h"===t?"pageX":"pageY"];if(c!==a){c=a,a=a-o+l;var r,h=n.layout[t+"Scroll"];r=i?c-o+s:Math.max(0,Math.min(h.space,a-Math.round(h.barSize/2))),"h"===t?n.setScrollbarOffset(r):n.setScrollbarOffset(null,r)}}};r.on("mousedown",function(a){a.preventDefault(),d=!0;var c=n.layout[t+"Scroll"],g="h"===t?"X":"Y";l=a["offset"+g],o=a["page"+g],i=e(a.target).is(".bar"),s=c.offset,i&&(l+=s),u(a),r.addClass("scrolling"),f.on("mouseup"+h,function(e){d=!1,u(e),f.off(h),r.removeClass("scrolling")}).on("mousemove"+h,u)}),n["$"+t+"Scroll"]=r,n["$"+t+"Scrollbar"]=r.find(".bar")};u("h"),u("v"),g.on("mousewheel",function(e){n.scroll(n.layout.scrollLeft+Math.round(event.deltaX),n.layout.scrollTop+Math.round(event.deltaY)),e.preventDefault()}),n.$container=g;var p=s.find(".datagrid-cells:first");if(p.length||(p=e('<div class="datagrid-cells" />').appendTo(g)),p.toggleClass("datagrid-hover-cell",!!l.hoverCell).toggleClass("datagrid-hover-row",!!l.hoverRow).toggleClass("datagrid-hover-col",!!l.hoverCol).toggleClass("datagrid-hover-shadow",!!l.hoverCol),n.$cells=p,n.isFuncConfigs=e.isFunction(l.configs),n.configs=n.isFuncConfigs?l.configs:e.extend({},o,l.configs),n.layout={scrollLeft:0,scrollTop:0},n.configsCache={},n.userConfigs={},n.states=e.extend(!0,{},i,l.states),n.cells=[],n.setPager(n.states.pager),n.setDataSource(l.dataSource),n.render(!0),l.responsive&&g.on("resize",function(){n.layout.cols=null,n.render()}),l.hoverCol&&p.on("mouseenter",".datagrid-cell-head",function(){var t=e(this),a=t.data("col");n.$cells.find(".datagrid-cell.hover").removeClass("hover"),n.$cells.find('.datagrid-cell[data-col="'+a+'"]').addClass("hover")}).on("mouseleave",".datagrid-cell-head.hover",function(){n.$cells.find(".datagrid-cell.hover").removeClass("hover")}),l.sortable&&p.on("click",".datagrid-col-sortable",function(){var t=e(this).data("col"),a=n.getColConfig(t),r=n.states.sortBy,o=n.states.order;r!==a.name?(r=a.name,o="desc"):"desc"===o?o="asc":"asc"===o&&(r=""),n.sortBy(r,o)}),l.checkable&&(l.selectable&&e.fn.selectable?(n.selectable=p.selectable(e.extend({selector:".datagrid-row-cell",clickBehavior:"multi",select:function(e){n.checkRow(e.id,!0)},unselect:function(e){n.checkRow(e.id,!1)}},e.isPlainObject(l.selectable)?l.selectable:null)).data("zui.selectable"),p.on("click",".datagrid-cell-head.datagrid-has-checkbox",function(){n.checkRow(e(this).data("row")),n.selectable.syncSelectionsFromClass()})):p.on("click",l.checkByClickRow?".datagrid-row":".datagrid-has-checkbox",function(t){n.checkRow(e(this).data("row"))})),e.fn.pager){var v=n.$.find(".pager");v.length&&(n.pagerObj=v.pager(e.extend({},n.pager,{onPageChange:function(e){n.setPager(e).render()}})).data("zui.pager"))}if(e.fn.searchBox){var m=n.$.find(".search-box");m&&(n.searchbox=m.searchBox({onSearchChange:function(e){n.search(e)}}))}n.$.callComEvent(n,"onReady",[n])};c.prototype.setPager=function(t,a,r){var o=this;"object"==typeof t&&(r=t.recPerPage,a=t.recTotal,t=t.page);var i=o.pager,n=e.extend({},i);return i||(i=e.extend({},l)),"number"==typeof r&&r>0&&(i.recPerPage=r),"number"==typeof a&&a>=0&&(i.recTotal=a),"number"==typeof t&&t>=0&&(i.page=t),i.totalPage=i.recTotal&&i.recPerPage?Math.ceil(i.recTotal/i.recPerPage):1,i.page=Math.max(0,Math.min(i.page,i.totalPage)),i.pageRecCount=i.recTotal,i.page&&i.recTotal&&(i.page<i.totalPage?i.pageRecCount=i.recPerPage:i.page>1&&(i.pageRecCount=i.recTotal-i.recPerPage*(i.page-1))),i.skip=i.page>1?(i.page-1)*i.recPerPage:0,i.end=i.skip+i.pageRecCount,o.pager=i,n.page===i.page&&n.recTotal===i.recTotal&&n.recPerPage===i.recPerPage||(o.layout.cols=null,o.pagerObj&&o.pagerObj.set(i),o.scroll(0,0)),o},c.prototype.goToPage=function(e){return this.setPager(e).render()},c.prototype.setSearch=function(a){return a!==t&&null!==a||(a=""),this.states.search=e.trim(a),this},c.prototype.search=function(e){var t=this;return e!==t.states.search&&t.pager.page&&t.setPager(1),t.setSearch(e).render()},c.prototype.setSorter=function(e,a){var r=this;return a===t&&(a="desc"===r.states.order?"asc":"desc"),r.states.order=a.toLowerCase(),r.states.sortBy=e,r},c.prototype.sortBy=function(e,t){return this.setSorter(e,t).render()},c.prototype.setDataSource=function(t,a){var r=this,o={},l=r.dataSource&&r.dataSource.cols;if(e.isArray(t)?(o.array=t,o.length=t.length,r.setPager("",t.length)):e.isPlainObject(t)?o=e.extend(o,t):"string"==typeof t&&(o.remote=t),o.cache===!0?(o.cache=[],o.cacheSize=10):"number"==typeof o.cache&&(o.cacheSize=o.cache,o.cache=[]),e.isArray(o.data)?(o.array=o.data,o.length=o.array.length,r.setPager("",o.length),delete o.data):!o.data&&e.isFunction(o.getByIndex)&&r.setPager("",o.length),r.dataSource=o,a=a||o.cols||l||[],a.length)for(var i=0;i<a.length;++i){var n=a[i];"string"==typeof n&&(a[i]={name:n})}a!==l&&(r.layout.cols=null),o.cols=a},c.prototype.filterData=function(e,t){var a=this,r=e,o=null;if(t.search){var l=t.search.replace(/\s{2,}/g," ").split(" ");r=[];for(var i=a.options.searchFunc||n,d=0;d<e.length;++d){var c=e[d],h=i(c,l,d,t,a);h&&(null===o&&(o="number"==typeof h),o&&(c._SCORE=h),r.push(c))}}if(r.length){var g=t.sortBy||!!o&&"_SCORE";if(g){var f="_SCORE"===g?"DESC":t.order,u=a.getColConfigByName(g),p="desc"===f,v=u&&u.sortFunc||a.options.sortFunc||s;r.sort(function(e,t){var r=v(e[g],t[g],e,t,g,a);return p?-1*r:r})}a.setPager(-1,r.length);var m=a.pager;if(m.page){m.page>1?m.page*m.recPerPage:0;r=r.slice(m.skip,m.end)}}return r},c.prototype.getFilterParams=function(){var e=this,t=e.states;return{page:e.pager.page,recPerPage:e.pager.recPerPage,search:t.search,sortBy:t.sortBy,order:t.order}},c.prototype.loadData=function(t){var a=this;a.loadingId=e.zui.uuid();var r=a.getFilterParams(),o=[r.page,r.recPerPage,r.search,r.sortBy,r.order].join("&"),l=a.getData(o);if(l)return t&&t(l);var i=a.dataSource;if(i.array)return l=a.filterData(i.array,r),a.resetData(o,l),t&&t(l);if(i.getByIndex)return l=i.getByIndex,a.resetData(o,l),t&&t(l);var n=i.loader,s=i.remote;if(!n&&s&&(n=function(t,r){var o=e.isFunction(s)?s(t,a):{url:s};e.ajax(e.extend({type:"GET",data:t,dataType:"json",success:function(t,o,l){if(i.remoteConverter&&(t=i.remoteConverter(t,o,l,a)),"string"==typeof t&&(t=e.parseJSON(t)),e.isPlainObject(t)&&t.data){var n=t.result||t.status;"success"===n||"ok"===n||200===n?r(t):r(!1,t.message||t.reason||a.lang.errorCannotHandleRemoteData,t)}else r(!1,a.lang.errorCannotHandleRemoteData,t)},error:function(){r(!1,a.lang.errorCannotGetDataFromRemote.format(i.remote))}},o))}),!n)return t&&t(!1);a.renderLoading(!0);var d=a.loadingId;n(r,function(e,t){if(d===a.loadingId)return t?void a.showMessage(t,"danger"):void a.resetData(o,e.data,e.pager)})},c.prototype.getDataItem=function(e,t,a){var r=this;return t=t||r.getData(),"function"==typeof t?(a=a||r.getFilterParams(),t(e,a)):t[e]},c.prototype.showMessage=function(a,r,o){var l=this;l.msgerAutoCloseTimer&&(clearTimeout(l.msgerAutoCloseTimer),l.msgerAutoCloseTimer=null);var i=l.$container.find(".datagrid-messager");return a?(r=r||"info",o===t&&(o=5e3),i.length||(i=e('<div class="datagrid-messager" style="display: none"><div class="content"></div><button type="button" class="close">×</button></div>').appendTo(l.$container).on("click",".close",function(){i.slideUp(),l.msgerAutoCloseTimer&&(clearTimeout(l.msgerAutoCloseTimer),l.msgerAutoCloseTimer=null)})),i.attr("class","datagrid-messager bg-"+r).find(".content").text(a),i.slideDown(),void(o&&(l.msgerAutoCloseTimer=setTimeout(function(){i.slideUp(),l.msgerAutoCloseTimer=null},o)))):void i.slideUp()},c.prototype.renderLoading=function(a){var r=this;a!==t&&(r.states.loading=a);var o=r.$container.find(".datagrid-loading");a?(o.length||(o=e('<div class="datagrid-loading" style="display: none"><div class="content"><i class="icon icon-spin icon-spinner icon-2x"></i><div className="datagrid-loading-message"></div></div></div>').appendTo(r.$container)),o.find(".datagrid-loading-message").text("string"==typeof a?a:""),o.fadeIn()):o.fadeOut()},c.prototype.getData=function(e){var t=this.dataSource,a=null;if(e&&e!==t.dataId){if(t.cache&&t.cache.length)for(var r=t.cache.length-1;r>0;--r){var o=t.cache[r];if(o.id===e){t.dataId=e,t.data=o.data,a=o.data;break}}}else a=t.data;return a},c.prototype.resetData=function(e,t,a){var r=this.dataSource;if(r.dataId=e,r.data=t,r.cache){for(var o=r.cache.length-1;o>0;--o){var l=r.cache[o];if(l.id===e){r.cache.splice(o,1);break}}for(r.cache.push({id:e,data:t});r.cache.length>r.cacheSize;)r.cache.shift()}a&&that.setPager(a)},c.prototype.getRowLayout=function(e){var t=this.layout;if(0===e)return{top:0,height:t.headerHeight};var a=t.rowHeight;return{height:a,top:t.headerHeight+(e>1?(e-1)*a:0)+e*t.borderWidth}},c.prototype.updateLayout=function(){var a=this,r=a.options,o=a.layout,l=(a.data,a.pager),i=l.pageRecCount,n=a.$container,s=n.width(),d=a.dataSource;if(!d.cols.length&&i&&e.each(a.getDataItem(0),function(e){d.cols.push({name:e})}),!o.cols){for(var c,h,g=d.cols,f=r.colAutoMinWidth,u=r.colAutoDefaultWidth,p=0,v=0,m=r.rowIndexWidth,y=[{left:0,width:r.showRowIndex?"auto"===m?8*(i+a.pager.skip+"").length+10:m:0}],w=0,C=y[0].width,b=!1,x=0,S=0,T=0;T<g.length;++T){var D=g[T];h=D.width,h&&"auto"!==h||(h=.1),c={left:0},h>=1?(D.minWidth!==t&&(h=Math.max(h,D.minWidth)),c.width=h,C+=h):(D.minWidth===t&&(D.minWidth=f),c.grow=h,p+=h,v+=D.minWidth,x<=c.grow&&(x=c.grow,b=T+1)),c.minWidth=D.minWidth,!S&&D.checkbox&&(S=T+1,c.checkbox=!0),y.push(c)}r.checkable&&!S&&(y[0].checkbox=!0,"auto"===m&&(y[0].width+=30));for(var R=s-C,M=R<v,P=y.length,L=0;L<P;++L){if(c=y[L],h=c.width,h||(h=M?u*c.grow*10:R*c.grow/p,h=Math.floor(Math.max(c.minWidth,h)),c.width=h),L>0){var H=y[L-1];c.left=H.left+H.width}w+=h}var k=s-w;b&&k>0&&(y[b].width+=k,w+=k),o.width=w,o.cols=y,console.log("Layout cols update",o)}o.containerWidth=s,o.rowHeight=r.rowDefaultHeight,o.borderWidth=r.borderWidth,o.headerHeight=r.showHeader?r.headerHeight:0,o.rowsLength=i+1,o.colsLength=o.cols.length,o.height=o.headerHeight+i*(o.rowHeight+o.borderWidth),o.spanMap={};var F=r.height;"page"===F&&(F=o.headerHeight+a.pager.recPerPage*(o.rowHeight+o.borderWidth)),n.css("height",F),o.containerHeight=F,o.vScrollSpare=o.height-o.containerHeight,o.hScrollSpare=o.width-o.containerWidth,a.layout=o;var W=!!l.page||r.partialRendering;return"auto"===W&&(W=o.height>2*o.containerHeight),o.partialRendering=W,o},c.prototype.getCell=function(e,a){var r,o,l=this,i=l.getCellConfig(e,a),n=a>0?l.dataSource.cols[a-1]:null;if(0===a){r="index";var s=e>0?l.pager.skip+e:"";o=i.label!==t?i.label:s}else 0===e?(r="head",o=i.label!==t?i.label:i.name!==t?i.name:a):(r="cell",o=i.data&&i.data[l.options.dataItemIsArray?a:n.name]);if(e>0&&i.valueType){var d=i.valueOperator||l.options.valueOperator;if(d){var c=d[i.valueType];c&&c.getter&&(o=c.getter(o,h,l))}}var h={type:r,value:o,rowIndex:e,colIndex:a,config:i,checked:l.isRowChecked(i.rowId)},g=l.layout.spanMap;if(g[i.id]||i.hidden)h.hidden=!0;else if(i.colspan&&i.colspan>1||i.rowspan&&i.rowspan>1){for(var f=e+(i.rowspan||1),u=a+(i.colspan||1),p=e;p<f;++p)for(var v=a;v<u;++v)p===e&&v===a||(g["R"+p+"C"+v]=i.id);i.span=!0}return h},c.prototype.getRowConfig=function(t){var a=this,r="R"+t,o=a.configsCache[r];o||(o=e.extend({},a.isFuncConfigs?a.configs(r):a.configs[r],a.userConfigs[r]),a.configsCache[r]=o);var l=t>0?a.getDataItem(t-1):null;return o.data=l,o.rowId=l?l.rowId||l.id:0===t?"#header":t,o},c.prototype.getColConfigByName=function(e){for(var t=this.dataSource.cols,a=0;a<t.length;++a)if(t[a].name===e)return this.getColConfig(a+1);return null},c.prototype.getColConfig=function(t){var a=this,r="C"+t,o=null;return o||(o=e.extend({valueType:"string"},t>0?a.dataSource.cols[t-1]:null,a.layout.cols[t],a.isFuncConfigs?a.configs(r):a.configs[r],a.userConfigs[r])),o},c.prototype.getCellConfig=function(t,a){var r=this,o="R"+t+"C"+a,l=null;return l||(l=e.extend({id:o},r.getColConfig(a),r.getRowConfig(t),r.isFuncConfigs?r.configs(o):r.configs[o],r.userConfigs[o])),l},c.prototype.isRowChecked=function(e){return!!this.states.selections[e]},c.prototype.checkRow=function(e,a){var r=this,o=r.states.selections,l=r.getRowConfig(e),i=l.rowId;if(a===t&&(a=!o[i]),o[i]!==a){if(a?o[i]=l:(delete o[i],e>0&&o["#header"]&&(delete o["#header"],r.renderRow(0))),r.renderRow(e),0===e&&r.layout.rowsLength<500)for(var n=1;n<r.layout.rowsLength;++n)r.checkRow(n,a);return a}},c.prototype.renderCell=function(t,a,r){var o=this,l=o.options,i=o.getCell(t,a),n=i.config;if(!i.hidden){var s=n.checkbox,d=[o.id,"cell",t,a].join("-"),c=e("#"+d);if(!c.length&&(r=r||e("#"+o.id+"-row-"+t),c=(l.cellCreator?l.cellCreator(i,o):e('<div class="datagrid-cell" />')).appendTo(r),c.attr({id:d,"data-type":i.type,"data-col":i.colIndex,"data-row":i.rowIndex}).toggleClass("datagrid-cell-head",0===t).toggleClass("datagrid-cell-cell","cell"===i.type).toggleClass("datagrid-cell-index",0===a),s)){var h=c.find(".datagrid-checkbox");h.length||(h=e('<div class="checkbox-primary datagrid-checkbox"><label></label></div>').prependTo(c.addClass("datagrid-has-checkbox"))),c.append('<span class="content"></span>')}var g=l.borderWidth,f=o.layout,u=f.colsLength,p={top:g?-g:0,bottom:g?-g:0,left:g?n.left-g:n.left,width:g?n.width+(u-1===a?2:1)*g:n.width,borderWidth:g};if(n.span&&(n.rowspan&&n.rowspan>1&&(p.bottom-=(n.rowspan-1)*(f.rowHeight+g)),n.colspan&&n.colspan>1))for(var v=a+n.colspan,m=a+1;m<v;++m){var y=o.getCell(t,m);p.width+=y.config.width}var w=n.style;e.isFunction(w)&&(w=w(i,p,o));var C=e.extend({},w,p);if(c.css(C).toggleClass("datagrid-cell-span",!!n.span),l.cellFormator)l.cellFormator(c,i);else{var b=s?c.find(".content"):c;b[i.html?"html":"text"](i.value),n.className&&c.addClass(n.className)}if(a>0&&0===t&&l.sortable&&n.sort!==!1){var x=!1;n.name===o.states.sortBy&&(x="desc"===o.states.order?"down":"up");var S=c.find(".datagrid-sorter");S.length||(S=e('<div class="datagrid-sorter"><i class="icon icon-sort"></i></div>').appendTo(c),c.addClass("datagrid-col-sortable")),S.toggleClass("datagrid-sort-up","up"===x).toggleClass("datagrid-sort-down","down"===x)}return s&&(c.find(".datagrid-checkbox").toggleClass("checked",i.checked),r.toggleClass("active",i.checked)),c}},c.prototype.renderRow=function(t){var a=this,r=a.layout,o=a.options,l=a.getRowLayout(t),i=r.colsLength,n=a.id+"-row-"+t,s=e("#"+n);s.length?r.partialRendering&&s.css("top",l.top-r.scrollTop):(s=(o.rowCreator?o.rowCreator(t,a):e('<div class="datagrid-row" />')).appendTo(a.$cells),s.attr({id:n,"data-row":t,"data-id":t}).css({top:r.partialRendering?l.top-r.scrollTop:l.top,height:l.height}).toggleClass("datagrid-row-head",0===t).toggleClass("datagrid-row-cell",0!==t));for(var d=0;d<i;++d)a.renderCell(t,d,s);return s},c.prototype.renderData=function(){var t=this,a=t.layout,r=1,o=a.rowsLength-1;if(a.partialRendering){var l=a.rowHeight+a.borderWidth;r=Math.min(o,Math.max(1,Math.floor((a.scrollTop-a.headerHeight)/l))),o=Math.min(o,Math.max(1,Math.ceil((a.scrollTop+a.containerHeight-a.headerHeight)/l))),t.$cells.find(".datagrid-row").each(function(){var t=e(this),a=t.data("row");a>0&&!t.hasClass("datagrid-fixed")&&(a<r||a>o)&&t.remove()})}t.options.showHeader&&t.renderRow(0);for(var i=r;i<=o;++i)t.renderRow(i);if(a.vScrollSpare){var n=t.states,s=n.fixedTopUntil,d=n.fixedBottomFrom;if("number"==typeof s&&s>0&&s<r)for(var i=1;i<=s;++i)t.renderRow(i);if("number"==typeof d&&d>0&&d>o)for(var i=d;i<=a.rowsLength-1;++i)t.renderRow(i)}},c.prototype.render=function(e){var t=this,a=t.options;return!e&&a.renderDelay?(t.renderDelayTimer&&clearTimeout(t.renderDelayTimer),t.renderDelayTimer=setTimeout(function(){t.render(!0)},a.renderDelay),t):(t.renderDelayTimer&&(clearTimeout(t.renderDelayTimer),t.renderDelayTimer=null),t.loadData(function(){var e=t.updateLayout();console.log("layout",e.spanMap),t.$cells.css({width:e.width,height:e.partialRendering?e.containerHeight:t.layout.height}),t.renderData(),t.renderScrolls(),t.renderFixeds(),t.$.callComEvent(t,"onRender")}),t)},c.prototype.setScrollbarOffset=function(e,t){var a=this,r=a.layout,o=r.scrollLeft,l=r.scrollTop;if("number"==typeof e){var i=r.hScroll;i.offset!==e&&(o=Math.round(e*r.hScrollSpare/i.space))}if("number"==typeof t){var n=r.vScroll;n.offset!==t&&(l=Math.round(t*r.vScrollSpare/n.space))}a.scroll(o,l)},c.prototype.renderScrolls=function(){var e=this,t=e.layout,a=t.vScrollSpare,r=t.hScrollSpare,o=a>0,l=r>0;if(e.$vScroll.toggle(o),e.$hScroll.toggle(l),t.scrollLeft=l?Math.max(0,Math.min(r,t.scrollLeft)):0,t.scrollTop=o?Math.max(0,Math.min(a,t.scrollTop)):0,o){var i=e.$vScrollbar,n=t.containerHeight/t.height,s=Math.max(20,Math.floor(n*t.containerHeight)),d=t.containerHeight-s,c=d/a,h=Math.round(t.scrollTop*c);t.vScroll={space:d,size:a,scale:c,barSize:s,offset:h};var g={height:s,top:h};i.css(g)}if(l){var i=e.$hScrollbar,n=t.containerWidth/t.width,s=Math.max(20,Math.floor(n*t.containerWidth)),d=t.containerWidth-s,h=Math.round(t.scrollLeft*d/r),g={width:s,left:h};t.hScroll={offset:h,space:d,size:r,barSize:s},i.css(g)}e.$cells.css({top:t.partialRendering?0:-t.scrollTop,left:-t.scrollLeft})},c.prototype.scroll=function(e,t,a){var r=this,o=new Date,l=r.options.scrollDelay;if(l){if(!a&&r.lastScrollTime&&o-r.lastScrollTime<l)return r.scrollDelayTimer&&clearTimeout(r.scrollDelayTimer),void(r.scrollDelayTimer=setTimeout(function(){r.scroll(e,t)},l-(o-r.lastScrollTime)));r.scrollDelayTimer&&(clearTimeout(r.scrollDelayTimer),r.scrollDelayTimer=null),r.lastScrollTime=o}var i=r.layout,n=!1,s=!1;"number"==typeof e&&(e=Math.max(0,Math.min(e,i.width-i.containerWidth)),e!==i.scrollLeft&&(n=!0,i.scrollLeft=e)),"number"==typeof t&&(t=Math.max(0,Math.min(t,i.height-i.containerHeight)),t!==i.scrollTop&&(s=!0,i.scrollTop=t)),s&&i.partialRendering&&r.renderData(),(n||s)&&(r.renderScrolls(),r.renderFixeds()),r.$.callComEvent(r,"onScroll",[e,t,{vScrolled:s,hScrolled:n}])},c.prototype.isRowVisible=function(e){},c.prototype.renderFixeds=function(){var t=this,a=t.states,r=t.layout;if(t.$cells.find(".datagrid-fixed").removeClass("datagrid-fixed"),t.$cells.find(".datagrid-fixed-edge-top").removeClass("datagrid-fixed-edge-top"),t.$cells.find(".datagrid-fixed-edge-bottom").removeClass("datagrid-fixed-edge-bottom"),t.$cells.find(".datagrid-fixed-edge-left").removeClass("datagrid-fixed-edge-left"),t.$cells.find(".datagrid-fixed-edge-right").removeClass("datagrid-fixed-edge-right"),r.vScrollSpare){var o=a.fixedTopUntil;if("number"==typeof o&&o>-1){o=Math.min(o,r.rowsLength);for(var l=0;l<=o;++l){var i=t.getRowLayout(l),n=e("#"+t.id+"-row-"+l),s=r.partialRendering?i.top:i.top+r.scrollTop;n.addClass("datagrid-fixed").css("top",s),l===o&&r.scrollTop&&n.addClass("datagrid-fixed-edge-top")}}else o=-1;var d=a.fixedBottomFrom;if("number"==typeof d&&d>-1){d=Math.max(o>-1?o+1:1,Math.min(d,r.rowsLength));for(var l=d;l<r.rowsLength;++l){var i=t.getRowLayout(l),n=e("#"+t.id+"-row-"+l),s=r.partialRendering?i.top-r.vScrollSpare:i.top-r.vScrollSpare+r.scrollTop;n.addClass("datagrid-fixed").css("top",s),l===d&&r.scrollTop<r.vScrollSpare&&n.addClass("datagrid-fixed-edge-bottom")}}}if(r.hScrollSpare){var c=a.fixedLeftUntil;if("number"==typeof c&&c>-1){c=Math.min(c,r.colsLength);for(var l=0;l<=c;++l){var h=r.cols[l],g=t.$cells.find('.datagrid-cell[data-col="'+l+'"]'),f=h.left+r.scrollLeft-r.borderWidth;g.addClass("datagrid-fixed").css("left",f),l===c&&r.scrollLeft&&g.addClass("datagrid-fixed-edge-left")}}else c=-1;var u=a.fixedRightFrom;if("number"==typeof u&&u>-1){u=Math.max(c>-1?c+1:1,Math.min(u,r.colsLength));for(var l=u;l<r.colsLength;++l){var h=r.cols[l],g=t.$cells.find('.datagrid-cell[data-col="'+l+'"]'),f=h.left-r.hScrollSpare+r.scrollLeft;g.addClass("datagrid-fixed").css("left",f),l===u&&r.scrollLeft<r.hScrollSpare&&g.addClass("datagrid-fixed-edge-right")}}}},c.DEFAULTS={width:"auto",height:400,dataSource:[],configs:null,states:null,rowDefaultHeight:30,colAutoDefaultWidth:80,colAutoMinWidth:50,showHeader:!0,headerHeight:30,showRowIndex:!0,rowIndexWidth:"auto",cellCreator:null,cellFormator:null,rowCreator:null,borderWidth:1,hoverRow:!0,hoverCol:!0,hoverCell:!0,responsive:!0,valueOperator:null,defaultDateFormater:"yyyy-MM-dd hh:mm",partialRendering:"auto",scrollDelay:0,renderDelay:100,dataItemIsArray:!1,onReady:null,onScroll:null,onRender:null,pager:null,searchFunc:null,sortFunc:null,sortable:!0,checkable:!0,checkByClickRow:!0,selectable:!0},e.fn.datagrid=function(t){return this.each(function(){var r=e(this),o=r.data(a),l="object"==typeof t&&t;o||r.data(a,o=new c(this,l)),"string"==typeof t&&o[t]()})},c.NAME=a,e.fn.datagrid.Constructor=c,e(function(){e('[data-ride="datagrid"]').datagrid()})}(jQuery,void 0);