/*!
 * ====================================================
 * ZUI - v1.1.0 - 2014-07-17
 * https://github.com/easysoft/zui
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2014 Catouse@easysoft; Licensed GNU
 * ====================================================
 */

+function(a,b,c,d){"use strict";var e="undefined",f=0,g=function(b,c){this.$=a(b),this.options=this.getOptions(c),this.lang=this.getLang(),this.data=this.options.data,this.dirtyData=!0,this.offsetX=0,this.offsetY=0,this.init()};g.DEFAULTS={hotkeyEnable:!0,hotkeys:{selectPrev:"Up",selectNext:"Down",selectLeft:"left",selectRight:"right",deleteNode:"del backspace",addBorther:"return",addChild:"tab insert",centerCanvas:"space"},lang:"zh_cn",langs:{zh_cn:{defaultName:"灵光闪现",defaultSubName:"灵光",defaultNodeName:"闪现",readonlyTip:"该节点已被设置为只读，无法进行编辑。",hotkeyDisabled:'快捷键不可用，需要 <a target="_blank" href="https://github.com/jeresig/jquery.hotkeys">jquery.hotkeys</a> 插件支持。'}},data:{text:"New Project",type:"root",expand:!0,theme:"default",caption:"",id:a.uuid()+""},nodeTeamplate:"<div id='node-{id}' class='mindmap-node expand-{expand}' data-type='{type}' data-id='{id}' data-parent='{parent}'><div class='wrapper'><div class='text'>{text}</div><div class='caption'>{caption}</div></div></div>",hSpace:100,vSpace:10,canvasPadding:20,removingNodeTip:null,lineCurvature:60,subLineWidth:4,lineColor:"rainbow",lineOpacity:1,lineSaturation:90,lineLightness:40,nodeLineWidth:2},g.prototype.getOptions=function(c){g.DEFAULTS.data.text=g.DEFAULTS.langs.zh_cn.defaultName,c=a.extend({},g.DEFAULTS,this.$.data(),c);var d=typeof a.hotkeys!=e;return!d&&c.hotkeyEnable&&b.messager.danger(this.lang.hotkeyDisabled),c.hotkeyEnable=c.hotkeyEnable&&d,c},g.prototype.getLang=function(){var c=this.options;if(!c.lang){if("undefined"!=typeof b.config&&b.config.clientLang)c.lang=config.clientLang;else{var d=a("html").attr("lang");c.lang=d?d:"en"}c.lang=c.lang.replace(/-/,"_").toLowerCase()}var e=c.langs[c.lang]||c.langs[g.DEFAULTS.lang];return c.defaultSubName&&(e.defaultSubName=c.defaultSubName),c.defaultNodeName&&(e.defaultNodeName=c.defaultNodeName),e},g.prototype.init=function(){this.initDom(),this.initSize(),this.bindEvents(),this.render()},g.prototype.initDom=function(){var b=this.$;b.attr("id")||b.attr("id","mindmap-"+a.uuid()),this.id=b.attr("id"),this.$container=b.children(".mindmap-container"),this.$container.length||(b.prepend("<div class='mindmap-container'></div>"),this.$container=b.children(".mindmap-container")),this.$canvas=this.$container.children("canvas"),this.$canvas.length||(this.$container.prepend("<canvas class='mindmap-bg'></canvas>".format(this.options.canvasSize)),this.$canvas=this.$container.children("canvas")),this.$desktop=this.$container.children(".mindmap-desktop"),this.$desktop.length||(this.$container.append("<div class='mindmap-desktop'></div>"),this.$desktop=this.$container.children(".mindmap-desktop")),this.$desktop.attr("unselectable","on");var c=b.children(".shadow");c.length||b.append("<div class='mindmap-shadow shadow-top'></div><div class='mindmap-shadow shadow-right'></div><div class='mindmap-shadow shadow-bottom'></div><div class='mindmap-shadow shadow-left'></div>")},g.prototype.initSize=function(){var a=this.$;this.winWidth=a.width(),this.winHeight=a.height(),this.centerX=d.floor(this.winWidth/2),this.centerY=d.floor(this.winHeight/2),this.dirtyData||this.display()},g.prototype.callEvent=function(b,c){return a.callEvent(this.options[b],c,this)},g.prototype.computePosition=function(a,b){var c=b?-1:1;return typeof a.left!=e&&(a.left-=(this.left-this.options.canvasPadding)*c),typeof a.top!=e&&(a.top-=this.top*c),typeof a.x!=e&&(a.x-=(this.left-this.options.canvasPadding)*c),typeof a.y!=e&&(a.y-=this.top*c),a},g.prototype.computeColor=function(a,b){return"hsla({h}, {s}%, {l}%, {a})".format({h:a,s:this.options.lineSaturation,l:this.options.lineLightness,a:b||this.options.lineOpacity})},g.prototype.getNodeData=function(b,c){if("number"==typeof b&&(b=b.toString()),c||(c=this.data),b==c.id)return c;if(a.isArray(c.children)&&c.children.length>0)for(var d in c.children){var e=this.getNodeData(b,c.children[d]);if(e)return e}return null},g.prototype.createDefaultNodeData=function(b){var c={expand:!0,id:a.uuid()+"",parent:b.id};return"root"===b.type?(c.type="sub",c.text=this.lang.defaultSubName):(c.type="node",c.text=this.lang.defaultNodeName),c},g.prototype.getNode=function(a){return"string"==typeof a?this.$desktop.children('[data-id="'+a+'"]'):typeof a.id!=e?a.ui.element:void 0},g.prototype.removeNode=function(a){if(this.getNode(a).remove(),a.count>0)for(var b in a.children)this.removeNode(a.children[b])},g.prototype.update=function(b,c,d){{var f=!1;this.options}if(a.isPlainObject(b)&&(b=[b]),a.isArray(b))for(var g in b){var h=b[g],i=h.data;if(i||(i=this.getNodeData(h.id)),!i)return;var j=h.action||"update";if("remove"===j||"delete"===j){var k=this.getNodeData(i.parent);k&&(k.children.splice(i.index,1),this.removeNode(i),this.clearNodeStatus(),"add"!=i.changed&&(a.isArray(k.deletions)?k.deletions.push(i):k.deletions=[i],i.changed="delete",k.changed="delete children"),d=!0,c=!0,f=!0)}else if("add"===j)a.isArray(i.children)?i.children.push(h.newData):i.children=[h.newData],i.count+=1,h.newData.index=i.count,h.newData.changed="add",d=!0,c=!0,f=!0;else if("move"===j){if(h.newParent!=i.parent){var l=this.getNodeData(h.newParent),k=this.getNodeData(i.parent);k&&l&&("root"===l.type?("node"===i.type&&(i.colorHue=null),i.type="sub",i.subSide=null):(i.type="node",i.subSide=l.subSide),k.children.splice(i.index,1),k.count-=1,a.isArray(l.children)?l.children.push(i):l.children=[i],l.count+=1,i.index=l.count,d=!0,c=!0,f=!0,"add"!=i.changed&&(i.changed="move"))}}else if("sort"===j){if(i.count>1){i.children.sort(h.func);for(var g in i.children){var m=i.children[g];m.index!=g&&(m.index=g,"add"!=m.changed&&(m.changed="sort"),d=!0,c=!0,f=!0)}}}else typeof h.text!=e&&h.text!=i.text&&(i.text=h.text,c=!0,f=!0),typeof h.subSide!=e&&h.subSide!=i.subSide&&(i.subSide=h.subSide,d=!0,c=!0,f=!0),f&&"add"!=i.changed&&(i.changed="edit")}d&&this.loadNode(),c&&this.showNode(),f&&this.callEvent("onChange",{changes:b,data:this.data})},g.prototype.clearChangeFlag=function(a){if(typeof a===e&&(a=this.data),a.changed&&(a.changed=null),a.children)for(var b in a.children)this.clearChangeFlag(a.children[b])},g.prototype.exportData=function(){var b=a.extend({},this.data);return this.fixExport(b),b},g.prototype.exportJSON=function(){return JSON.stringify(this.exportData())},g.prototype.exportArray=function(b,c){typeof b===e&&(b=this.data),typeof c===e&&(c=[]);var d=a.extend({},b);if(delete d.ui,delete d.children,delete d.subSide,c.push(d),b.children)for(var f in b.children)this.exportArray(b.children[f],c);return c},g.prototype.fixExport=function(a){if(delete a.ui,a.children)for(var b in a.children)this.fixExport(a.children[b])},g.prototype.load=function(a){this.data=a,this.render(a)},g.prototype.render=function(){this.loadNode(),this.showNode()},g.prototype.loadNode=function(b,c){b||(b=this.data);var g=this.options,h=this.$desktop,i="object"==typeof c&&c.id?c.id:"";typeof b.expand===e&&(b.expand=!0),typeof b.data===e&&(b.data={}),typeof b.type===e&&(b.type="node"),typeof b.id===e&&(b.id=a.uuid()+""),typeof b.readonly===e&&(b.readonly=!1),typeof b.ui===e&&(b.ui={}),b.parent=i;var j=h.children('.mindmap-node[data-id="'+b.id+'"]');if(j.length?(j.toggleClass("expand-false",!b.expand).toggleClass("expand-true",b.expand).attr("data-type",b.type).attr("data-parent",i||"root"),j.children(".text").html(b.text),j.children(".caption").html(b.caption)):(j=a(g.nodeTeamplate.format({type:b.type||"node",expand:b.expand,caption:b.caption||"",id:b.id,parent:i||"root",text:b.text})).appendTo(h),this.bindNodeEvents(j),b.ui.element=j),"root"===b.type)b.ui.subLeftSide=0,b.ui.subRightSide=0,b.ui.vLeftSpan=0,b.ui.vRightSpan=0;else if("sub"===b.type){var k=b.subSide;k||(k=c.ui.subRightSide>c.ui.subLeftSide?"left":"right"),"left"===k?c.ui.subLeftSide++:c.ui.subRightSide++,b.subSide=k,typeof b.colorHue===e&&(b.colorHue=d.floor(55*f++%360))}else b.subSide=c.subSide;j.data("origin-text",b.text),j.toggleClass("readonly",b.readonly);var l=1;if(b.count=0,a.isArray(b.children)&&b.children.length>0){b.ui.topSpanTemp="root"===b.type?{left:0,right:0}:0;var m=0,n=0,o=null;l=0,b.children.sort(function(a,b){return a.index-b.index});for(var p in b.children){var q=b.children[p];typeof q.ui===e&&(q.ui={}),"sub"!=q.type&&(q.colorHue=b.colorHue),q.ui.nextBorther=null,o?(q.ui.prevBorther=o.id,o.ui.nextBorther=q.id):q.ui.prevBorther=null,o=q,this.loadNode(q,b,p),q.index=b.count++,"undifined"==typeof q.order&&(q.order=q.index),l+=q.ui.vSpan,"sub"===q.type?"left"===q.subSide?(m+=q.ui.vSpan,q.ui.topSpan=b.ui.topSpanTemp.left,b.ui.topSpanTemp.left+=q.ui.vSpan):(n+=q.ui.vSpan,q.ui.topSpan=b.ui.topSpanTemp.right,b.ui.topSpanTemp.right+=q.ui.vSpan):(q.ui.topSpan=b.ui.topSpanTemp,b.ui.topSpanTemp+=q.ui.vSpan)}"root"===b.type&&(b.ui.vLeftSpan=m,b.ui.vRightSpan=n)}"root"!=b.type&&(b.ui.vSpan=l),this.dirtyData=!1,"root"===b.type&&this.callEvent("afterLoad",{data:b})},g.prototype.showNode=function(b,c){b||(b=this.data);var e=this.options,f=b.ui,g=b.ui.element;if(f.width=g.outerWidth(),f.height=g.outerHeight(),"root"===b.type)f.left=0-d.floor(f.width/2),f.top=0-d.floor(f.height/2),this.left=0-d.floor(d.max(f.width+e.canvasPadding,this.winWidth)/4),this.right=0-this.left,this.top=0-d.floor(d.max(f.height+e.canvasPadding,this.winHeight)/4),this.bottom=0-this.top;else if(a.isPlainObject(f.dragPos))f.left=f.dragPos.left,f.top=f.dragPos.top;else{if("sub"===b.type){var h=0;"left"===b.subSide?(f.left=c.ui.left-e.hSpace-20-f.width,h=c.ui.vLeftSpan):(f.left=c.ui.left+c.ui.width+e.hSpace+20,h=c.ui.vRightSpan);var i=h*f.height+(h-1)*e.vSpace,j=0-d.floor(i/2),k=f.topSpan*f.height+f.topSpan*e.vSpace,l=f.vSpan*f.height+(f.vSpan-1)*e.vSpace;f.top=j+k+d.floor((l-f.height)/2)}else{f.left="left"===b.subSide?c.ui.left-e.hSpace-f.width:c.ui.left+c.ui.width+e.hSpace;var i=c.ui.vSpan*f.height+(c.ui.vSpan-1)*e.vSpace,j=c.ui.top+d.floor(c.ui.height/2)-d.floor(i/2),k=f.topSpan*f.height+f.topSpan*e.vSpace,l=f.vSpan*f.height+(f.vSpan-1)*e.vSpace;f.top=j+k+d.floor((l-f.height)/2)}"left"===b.subSide?this.left=d.min(this.left,f.left):this.right=d.max(this.right,f.left+f.width),this.top=d.min(this.top,f.top),this.bottom=d.max(this.bottom,f.top+f.height)}if(a.isArray(b.children)&&b.children.length>0)for(var m in b.children)this.showNode(b.children[m],b);if("root"===b.type){var n=this.options.canvasPadding;this.left-=n,this.top-=n,this.right+=2*n,this.bottom+=n,this.width=this.right-this.left,this.height=this.bottom-this.top,this.display(),this.draw(),this.callEvent("afterShow",{data:b})}},g.prototype.display=function(a,b,c){"number"==typeof a&&"number"==typeof b&&(c&&(a+=this.offsetX,b+=this.offsetY),this.offsetX=a,this.offsetY=b),this.x=this.centerX+this.left+this.offsetX,this.y=this.centerY+this.top+this.offsetY,this.$container.css({width:this.width,height:this.height,top:this.y,left:this.x});var d=this.options.canvasPadding;this.$.toggleClass("shadow-left",this.x<0-d).toggleClass("shadow-right",this.x+this.width>this.winWidth+d).toggleClass("shadow-top",this.y<0-d).toggleClass("shadow-bottom",this.y+this.height>this.winHeight+d)},g.prototype.makeNodeVisble=function(a){var b=this.getNodeData(a.data("id"));if(b){var c=b.ui.left-this.left+this.x,d=b.ui.top-this.top+this.y,e=this.options.canvasPadding;if(0>c)this.offsetX+=0-c;else{var f=c+b.ui.width-(this.winWidth+e);f>0&&(this.offsetX+=0-f-80)}if(0>d)this.offsetY+=0-d;else{var f=d+b.ui.height-(this.winWidth+e);f>0&&(this.offsetY+=0-f-80)}this.display()}},g.prototype.clearCanvasArea=function(){this.$canvas[0].getContext("2d").clearRect(0,0,this.width,this.height)},g.prototype.draw=function(b,c){if(b||(b=this.data),"root"===b.type&&(this.$canvas.attr({width:this.width,height:this.height}),this.clearCanvasArea()),c){var e="left"===b.subSide,f=this.options,g=this.$canvas[0].getContext("2d"),h={x:c.ui.left+("root"===c.type?d.floor(c.ui.width/2):e?0:c.ui.width),y:c.ui.top+d.floor(c.ui.height/2)},i={x:b.ui.left+(e?b.ui.width:0),y:b.ui.top+d.floor(b.ui.height/2)},j={x:h.x+(e?-1:1)*f.lineCurvature,y:h.y},k={x:i.x+(e?1:-1)*f.lineCurvature,y:i.y};h=this.computePosition(h),i=this.computePosition(i),j=this.computePosition(j),k=this.computePosition(k),g.beginPath(),g.strokeStyle=this.computeColor(b.colorHue,b.ui.canDrop?".25":"1"),g.lineCap="round",g.lineWidth="sub"===b.type?f.subLineWidth:f.nodeLineWidth,g.moveTo(h.x,h.y),g.bezierCurveTo(j.x,j.y,k.x,k.y,i.x,i.y),g.stroke()}if(b.ui.element.css(this.computePosition({left:b.ui.left,top:b.ui.top})),a.isArray(b.children)&&b.children.length>0)for(var l in b.children)this.draw(b.children[l],b)},g.prototype.bindNodeEvents=function(a){var b,c=this;a.on("click",function(b){c.onNodeClick(b,a)}).mousedown(function(a){a.stopPropagation()}),a.find(".text").on("keyup paste blur",function(b){c.onNodeTextChanged(b,a)}).on("keydown",function(){}),"root"!=a.data("type")&&a.droppable({container:c.$,target:"#"+c.id+' .mindmap-node:not([data-id="'+a.data("id")+'"]',before:function(d){return c.callEvent("beforeDrag",{node:a})?d.element.hasClass("focus")?!1:(b=c.getNodeData(d.element.data("id")),b?void 0:!1):!1},start:function(b){c.callEvent("startDrag",{node:a}),b.element.hasClass("active")||(c.clearNodeStatus(),c.activeNode(a))},drag:function(a){a.pos.left-=c.x,a.pos.top-=c.y,b.ui.dragPos=c.computePosition(a.pos,!0),b.ui.canDrop=a.isIn,c.showNode()},beforeDrop:function(d){if(d.isIn){if(d.target.data("id")==b.parent)return!1}else{if(!c.callEvent("beforeSort",{node:a,event:d}))return;var e=b.subSide;"sub"===b.type&&(b.ui.left<-30?e="left":b.ui.left>30&&(e="right")),c.update([{action:"sort",data:c.getNodeData(b.parent),func:function(a,b){return a.ui.top-b.ui.top}},{data:b,subSide:e}]),c.callEvent("afterSort",{node:a,event:d})}},drop:function(a){c.callEvent("beforeMove",{node:b,event:a})&&(c.update({action:"move",data:b,newParent:a.target.data("id")}),c.callEvent("afterMove",{node:b,event:a}))},finish:function(){b.ui.dragPos=null,b.ui.canDrop=!1,c.showNode()}}),this.callEvent("onBindEvents",{node:a})},g.prototype.onNodeClick=function(a,b){b.hasClass("active")?this.focusNode(b):(this.clearNodeStatus(),this.activeNode(b)),this.callEvent("onNodeClick",{node:b}),a.stopPropagation()},g.prototype.onNodeTextChanged=function(a,b){var c=b.find(".text").text();c!=b.data("origin-text")&&(""==c&&b.find(".text").text(""),b.data("origin-text",c),this.update({id:b.data("id"),text:c}),this.callEvent("onTextChanged",{node:b,text:c}))},g.prototype.activeNode=function(a){typeof a===e&&(a=this.$desktop.children('.mindmap-node[data-type="sub"]').first()),a.length||(a=this.$desktop.children(".mindmap-node").first()),this.callEvent("beforeNodeActive",{node:a})&&(a.addClass("active"),this.makeNodeVisble(a),this.activedNode=a,this.isActive=!0,this.callEvent("onNodeActive",{node:a}))},g.prototype.focusNode=function(a,c){if(a.hasClass("readonly"))return void b.messager.show(this.lang.readonlyTip);if(a.hasClass("active")&&this.callEvent("beforeNodeFocus",{node:a})){var d=a.addClass("focus").find(".text");d.attr("contenteditable","true"),this.makeNodeVisble(a),d.focus(),(c||typeof c===e)&&d.selectText(),this.isFocus=!0}},g.prototype.clearActiveNode=function(a){typeof a===e&&(a=this.$desktop.children(".mindmap-node.active")),a.removeClass("active"),this.isActive=!1,this.activedNode=null},g.prototype.clearFocusNode=function(a){typeof a===e&&(a=this.$desktop.children(".mindmap-node.focus")),a.removeClass("focus").find(".text").attr("contenteditable","false").blur(),this.isFocus=!1},g.prototype.bindEvents=function(){var b=this.$,c=this;b.resize(a.proxy(this.initSize,this)).click(a.proxy(this.onDesktopClick,this)),this.bindGlobalHotkeys(),this.$container.draggable({before:function(){return c.callEvent("beforeMoveCanvas")?void 0:!1},finish:function(a){c.display(a.smallOffset.x,a.smallOffset.y,!0)},drag:function(a){c.display(a.smallOffset.x,a.smallOffset.y,!0)}})},g.prototype.bindGlobalHotkeys=function(){var b=this.options;if(b.hotkeyEnable){var d=this,e=b.hotkeys;a(c).on("keydown",null,e.selectPrev,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.selectPrev})&&d.selectNode("prev")}).on("keydown",null,e.selectNext,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.selectNext})&&d.selectNode("next")}).on("keydown",null,e.selectLeft,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.selectLeft})&&d.selectNode("left")}).on("keydown",null,e.selectRight,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.selectRight})&&d.selectNode("right")}).on("keydown",null,e.deleteNode,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.deleteNode})&&(d.deleteNode(),8!=event.keyCode||d.isFocus||event.preventDefault())}).on("keydown",null,e.addBorther,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.addBorther})&&d.addBortherNode()}).on("keydown",null,e.addChild,function(a){d.callEvent("beforeHotkey",{event:a,hotkey:e.addChild})&&(d.addChildNode(),9==a.keyCode&&a.preventDefault())}).on("keydown",function(){if(d.callEvent("beforeHotkey",{event:event,type:"keydown"})&&event.keyCode>=48&&event.keyCode<=111&&d.isActive&&!d.isFocus){var a=d.activedNode;a&&(a.find(".text").text(""),d.focusNode(a))}}).on("keydown",null,e.centerCanvas,function(){d.callEvent("beforeHotkey",{event:event,hotkey:e.centerCanvas})&&d.display(0,0)})}},g.prototype.addBortherNode=function(){if(this.isActive){var a=this.getNodeData(this.activedNode.data("id"));if(a){var b="root"===a.type?a:this.getNodeData(a.parent),c=this.createDefaultNodeData(b);if(!this.callEvent("beforeAdd",{node:b,newNode:c}))return;this.update({action:"add",data:b,newData:c}),this.clearNodeStatus();var d=this.getNode(c.id);this.activeNode(d),this.focusNode(d,!0),this.callEvent("afterAdd",{node:b,newNode:c})}}},g.prototype.addChildNode=function(){if(this.isActive){var a=this.getNodeData(this.activedNode.data("id"));if(a){var b=this.createDefaultNodeData(a);if(!this.callEvent("beforeAdd",{node:a,newNode:b}))return;this.update({action:"add",data:a,newData:b}),this.clearNodeStatus();var c=this.getNode(b.id);this.activeNode(c),this.focusNode(c,!0),this.callEvent("afterAdd",{node:a,newNode:b})}}},g.prototype.deleteNode=function(){if(!this.isFocus&&this.isActive){var a=this.getNodeData(this.activedNode.data("id"));if(a){if(!this.callEvent("beforeDelete",{node:a}))return;this.update({action:"remove",data:a}),this.callEvent("afterDelete",{node:a})}}},g.prototype.selectNode=function(a){if(!this.isFocus){if(!this.isActive)return void this.activeNode();var b=null,c=this.getNodeData(this.activedNode.data("id")),d=null;switch("root"===c.type?a="prev"===a||"left"===a?"left":"right":"left"===a?a="left"==c.subSide?"child":"parent":"right"===a&&(a="right"==c.subSide?"child":"parent"),a){case"prev":d=c.ui.prevBorther;break;case"next":d=c.ui.nextBorther;break;case"parent":d=c.parent;break;case"child":c.count>0&&(d=c.children[0].id);break;case"left":if(c.count>0){d=c.children[0].id;for(var e in c.children){var f=c.children[e];if("left"==f.subSide){d=f.id;break}}}break;case"right":if(c.count>0){d=c.children[0].id;for(var e in c.children){var f=c.children[e];if("right"==f.subSide){d=f.id;break}}}}d&&(b=this.getNodeData(d)),b&&(this.clearNodeStatus(),this.activeNode(b.ui.element))}},g.prototype.selectNext=function(){if(!this.isFocus){var a=null;this.isActive||this.activeNode();var b=this.getNodeData(this.activedNode.data("id"));null!=b.ui.nextBorther&&(a=this.getNodeData(b.ui.nextBorther)),a&&(this.clearNodeStatus(),this.activeNode(a.ui.element))}},g.prototype.selectLeft=function(){if(!this.isFocus){var a=null;this.isActive||this.activeNode();var b=this.getNodeData(this.activedNode.data("id"));null!=b.ui.leftBorther&&(a=this.getNodeData(b.ui.leftBorther)),a&&(this.clearNodeStatus(),this.activeNode(a.ui.element))}},g.prototype.onDesktopClick=function(){this.$desktop;this.clearNodeStatus()},g.prototype.clearNodeStatus=function(){this.clearActiveNode(),this.clearFocusNode()},a.fn.mindmap=function(b){return this.each(function(){var c=a(this),d=c.data("zui.mindmap"),e="object"==typeof b&&b;d||c.data("zui.mindmap",d=new g(this,e)),"string"==typeof b&&d[b]()})},a.fn.mindmap.Constructor=g}(jQuery,window,document,Math);